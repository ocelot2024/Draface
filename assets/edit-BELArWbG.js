import{_ as y,c as O,a as m,o as r,r as I,n as Q,b as g,d as C,w as d,e as i,f as p,g as V,t as v,p as de,h as ce,i as X,V as D,j as Y,A as j,E as P,T as R,k as B,l as pe,u as S,m as F,q as Z,s as fe,v as U,F as $,x as N,y as A,z as ee,M as z,B as me,C as te,D as _e,G as H,H as ne,I as ve,J as se,K as ge,L as we,N as he}from"./index-Dj2-D-gM.js";const ye={__name:"Hstack",props:{Spacing:[Number,String],Align:String,Justify:String},setup(t){const e=t,n=O(()=>({display:"flex",flexDirection:"row",alignItems:e.Align||"center",justifyContent:e.Justify||"center",gap:e.Spacing+"px"||0}));return(a,s)=>(r(),m("div",{class:"h-stack",style:Q(n.value)},[I(a.$slots,"default",{},void 0,!0)],4))}},b=y(ye,[["__scopeId","data-v-458f31d9"]]),xe={},be={class:"material-symbols-rounded"};function ke(t,e){return r(),m("span",be,[I(t.$slots,"default",{},void 0,!0)])}const J=y(xe,[["render",ke],["__scopeId","data-v-cba4735d"]]),$e={class:"menu-buttons"},Ee={__name:"MenuBar",emits:["help"],setup(t){const e=g(!0),n=g(null);return de("menu_manager",{openID:n,open(a){n.value=n.value===a?null:a},close(){n.value=null}}),(a,s)=>(r(),C(b,{class:"menu-bar blurred","-justify":"left"},{default:d(()=>[i("div",$e,[p(b,{"-justify":"left",style:{width:"100vw"}},{default:d(()=>[p(b,{"-justify":"left","-spacing":"14",style:{flex:"1"}},{default:d(()=>[I(a.$slots,"default",{},void 0,!0)]),_:3}),p(b,{style:{flex:"0","padding-right":"24px"},"-spacing":"14"},{default:d(()=>[p(J,{onClick:s[0]||(s[0]=u=>a.$emit("help"))},{default:d(()=>s[2]||(s[2]=[V("help")])),_:1,__:[2]}),p(J,{onClick:s[1]||(s[1]=u=>e.value=!e.value)},{default:d(()=>[V(v(e.value?"keep":"keep_off"),1)]),_:1})]),_:1})]),_:3})])]),_:3}))}},je=y(Ee,[["__scopeId","data-v-83c104e1"]]),Ce={class:"menu-wrapper"},Ie={__name:"MenuButton",props:["label"],setup(t){const e=t,n=g(ce()),a=X("menu_manager"),s=O(()=>a.openID.value===n.value),u=()=>{a.open(n.value)};return(l,o)=>(r(),m("div",Ce,[i("button",{class:"menu-button",onClick:o[0]||(o[0]=c=>u())},v(e.label),1),i("div",{class:Y(["menu-list blurred",{open:s.value}])},[p(D,{justify:"flex-start"},{default:d(()=>[I(l.$slots,"default",{},void 0,!0)]),_:3})],2)]))}},Se=y(Ie,[["__scopeId","data-v-039af5d5"]]),Le={__name:"MenuItem",props:{key_bind:Object,separate:{default(){return"none"},validator(t,e){return["above","bellow","none"].includes(t)}}},emits:["menu_click"],setup(t,{emit:e}){const n=t,a=e,s=X("menu_manager"),u=()=>{s.close(),a("menu_click")};return(l,o)=>(r(),m("span",{class:Y([n.separate,"menu-item"]),onClick:u},[I(l.$slots,"default",{},void 0,!0)],2))}},Me=y(Le,[["__scopeId","data-v-5be2fc5c"]]),Ue=(t,e,n,a)=>{if(!["Enter","Tab"].includes(t.key))return;const s=e.value;if(!s)return;const u=s.value,l=s.selectionStart,o=u.slice(0,l),c=u.slice(l),f=j.apps.Editor.indent_char==P.indent_char.Space?" ".repeat(R[j.apps.Editor.space_len]):"	";if(t.key==="Tab")t.preventDefault(),n.value=o+f+c,B(()=>s.selectionStart=s.selectionEnd=l+f.length);else if(t.key==="Enter"){t.preventDefault();const w=o.split(`
`),x=w[w.length-1];let k="";for(const _ of x)if(_===" "||_==="	")k+=_;else break;let E=`
`;if(j.apps.Editor.indent_char===P.indent_char.Space){const _=k.split("").filter(ue=>ue===" ").length,h=Math.floor(_/R[j.apps.Editor.space_len]);E+=f.repeat(h)}else{const _=k.split("").filter(h=>h==="	").length;E+=f.repeat(_)}const L=w.join(`
`)+E;n.value=L+c,ae(t,e,n,a),B(()=>s.selectionStart=s.selectionEnd=L.length)}};let q;const ae=(t,e,n,a)=>{cancelAnimationFrame(q),q=requestAnimationFrame(()=>{a.value=e.value.value.split(`
`)})},G=(t,e,n,a,s)=>{t.value||(n={start:{line:0,column:0},end:{line:0,column:0}}),requestAnimationFrame(()=>{const u=t.value.selectionStart,l=t.value.selectionEnd,o=f=>{const w=e.value.slice(0,f),x=w.split(`
`).length-1,k=w.split(`
`).pop().length;return{line:x,column:k}};n.start=o(u),n.end=o(l);const c=pe(s.value[0]);t.value.style.left=c.viewportLeft+"px",t.value.style.top=c.viewportTop+"px",s.value[0].style.animation="none",s.value[0].offsetWidth,s.value[0].style.animation="",le(n.end.line,a)})},De=t=>26*t,le=(t,e)=>{e.value.scrollTop=De(t)},Te={class:"row_num"},Ve={key:0,style:{flex:"1","white-space":"pre-wrap","word-break":"break-word"}},Be={class:"caret-parent"},Fe={key:1},Ne={key:1,style:{flex:"1","white-space":"pre-wrap","word-break":"break-word"}},Oe={class:"high"},Ae={key:1,class:"high"},ze={class:"high"},Pe={class:"caret-parent"},Re={__name:"editor",props:{modelValue:{},modelModifiers:{}},emits:["update:modelValue"],setup(t){const e=g(null),n=g(null),a=g(null),s=S(t,"modelValue"),u=g([""]),l=F({start:{line:0,column:0},end:{line:0,column:0}}),o=E=>{Ue(E,e,s,u),B(()=>{G(e,s,l,n,a)})},c=E=>{ae(E,e,s,u),B(()=>{G(e,s,l,n,a),le(l.end.line,n)})},f=g(!1),w=O(()=>l.start.line===l.end.line&&l.start.column===l.end.column),x=()=>{e.value.focus(),f.value=!0},k=()=>{f.value=!1};return Z(()=>{x(),e.value.addEventListener("keydown",o),e.value.addEventListener("change",k),e.value.addEventListener("click",oninput),n.value.addEventListener("click",x)}),fe(()=>{e.value.removeEventListener("keydown",o),e.value.removeEventListener("change",k),e.value.removeEventListener("click",oninput),n.value.removeEventListener("click",x)}),(E,L)=>(r(),m($,null,[i("div",{class:"text-canvas",ref_key:"canvas",ref:n},[(r(!0),m($,null,N(u.value,(_,h)=>(r(),m("div",{style:{display:"flex","font-size":"large",gap:"2px"},key:h},[i("div",Te,v(h+1),1),w.value?(r(),m("div",Ve,[h===l.end.line?(r(),m($,{key:0},[i("span",null,v(_.slice(0,l.end.column)),1),i("span",Be,[U(i("span",{class:"caret",ref_for:!0,ref_key:"carret",ref:a},null,512),[[A,f.value]])]),i("span",null,v(_.slice(l.end.column)),1)],64)):(r(),m("span",Fe,v(_),1))])):(r(),m("div",Ne,[l.start.line==h?(r(),m($,{key:0},[i("span",null,v(_.slice(0,l.start.column)),1),i("span",Oe,v(_.slice(l.start.column,l.end.line!=l.start.line?_.length:l.end.column)),1),i("span",null,v(_.slice(l.end.column+1)),1)],64)):l.start.line<h&&h<l.end.line?(r(),m("span",Ae,v(_),1)):h===l.end.line?(r(),m($,{key:2},[i("span",ze,v(_.slice(0,l.end.column)),1),i("span",Pe,[U(i("span",{class:"caret",ref_for:!0,ref_key:"carret",ref:a},null,512),[[A,f.value]])]),i("span",null,v(_.slice(l.end.column)),1)],64)):(r(),m($,{key:3},[V(v(_),1)],64))]))]))),128))],512),U(i("textarea",{id:"editor",ref_key:"text_input",ref:e,"onUpdate:modelValue":L[0]||(L[0]=_=>s.value=_),onInput:c,style:{position:"absolute","z-index":"0"}},null,544),[[ee,s.value]])],64))}},He=y(Re,[["__scopeId","data-v-dce45d26"]]),Je="/Neffice/edit.svg",qe={__name:"about",props:{shown:{},shownModifiers:{}},emits:["update:shown"],setup(t){const e=S(t,"shown");return(n,a)=>(r(),C(z,{shown:e.value,"onUpdate:shown":a[0]||(a[0]=s=>e.value=s)},{default:d(()=>[p(D,{style:{padding:"7px"}},{default:d(()=>a[1]||(a[1]=[i("img",{src:Je,width:"150px"},null,-1),i("h1",null,"Edit",-1),i("p",null,"ブラウザ上で動作するシンプルなテキストエディタ。",-1),i("br",null,null,-1),i("small",null,"Built with Vue.js",-1)])),_:1,__:[1]})]),_:1},8,["shown"]))}},Ge={style:{width:"100%"}},Ke={key:0},We={__name:"groupBox",props:["header","bg"],setup(t){const e=t;return(n,a)=>(r(),m("div",Ge,[e.header?(r(),m("small",Ke,v(e.header),1)):me("",!0),i("div",{class:"group",style:Q({backgroundColor:e.bg??"var(--colour-foreground)"})},[I(n.$slots,"default",{},void 0,!0)],4)]))}},oe=y(We,[["__scopeId","data-v-60daa9a3"]]),Qe={__name:"ListItem",emits:["click"],setup(t){return(e,n)=>(r(),m("div",{class:"listitem",onClick:n[0]||(n[0]=a=>e.$emit("click"))},[I(e.$slots,"default",{},void 0,!0)]))}},T=y(Qe,[["__scopeId","data-v-3fa901d1"]]),Xe={style:{padding:"7px"}},Ye={__name:"PullDown",props:te(["options"],{selected:{},selectedModifiers:{}}),emits:["update:selected"],setup(t){const e=t,n=S(t,"selected"),a=g(!1),s=O(()=>e.options[n.value]??"選択してください"),u=c=>{n.value=c,a.value=!1},l=g(null),o=c=>{l.value&&!l.value.contains(c.target)&&(a.value=!1)};return Z(()=>{document.addEventListener("click",o)}),_e(()=>{document.removeEventListener("click",o)}),(c,f)=>(r(),m("div",{class:"border",ref_key:"DropDown_ref",ref:l},[p(b,{spacing:10,onClick:[f[0]||(f[0]=w=>a.value=!0),f[1]||(f[1]=H(()=>{},["stop"]))]},{default:d(()=>[(r(),m("div",{style:{"min-width":"85px",width:"max-content"},key:n.value},v(s.value),1)),f[3]||(f[3]=i("div",{class:"triangle"},null,-1))]),_:1,__:[3]}),U(p(D,{class:"options blurred",align:"start",onClick:f[2]||(f[2]=H(()=>{},["stop"]))},{default:d(()=>[p(oe,{bg:"transparent"},{default:d(()=>[(r(!0),m($,null,N(e.options,(w,x)=>(r(),C(T,{key:x,onClick:k=>u(x)},{default:d(()=>[i("div",Xe,v(w),1)]),_:2},1032,["onClick"]))),128))]),_:1})]),_:1},512),[[A,a.value]])],512))}},K=y(Ye,[["__scopeId","data-v-18dce54b"]]),Ze={__name:"settings",props:{shown:{},shownModifiers:{}},emits:["update:shown"],setup(t){const e=S(t,"shown"),n=g(j.apps.Editor.indent_char),a=g(j.apps.Editor.space_len),s={footerButtons:[{label:"キャンセル",onClick:()=>{e.value=!1}},{label:"保存",type:"primary",onClick:()=>{j.apps.Editor.indent_char=n.value,j.apps.Editor.space_len=a.value,ve(),e.value=!1}}]};return(u,l)=>(r(),C(z,ne({shown:e.value,"onUpdate:shown":l[2]||(l[2]=o=>e.value=o)},s),{default:d(()=>[p(D,{class:"modal"},{default:d(()=>[p(oe,{header:"エディタ"},{default:d(()=>[p(T,null,{default:d(()=>[p(b,{"-justify":"flex-start",style:{padding:"7px"}},{default:d(()=>[l[3]||(l[3]=i("p",{style:{flex:"1"}},"タブの種類",-1)),p(K,{style:{flex:"0"},selected:n.value,"onUpdate:selected":l[0]||(l[0]=o=>n.value=o),options:["タブ文字","スペース"]},null,8,["selected"])]),_:1,__:[3]})]),_:1}),p(T,null,{default:d(()=>[p(b,{"-justify":"flex-start",style:{padding:"7px"}},{default:d(()=>[l[4]||(l[4]=i("p",{style:{flex:"1"}},"タブの文字数",-1)),p(K,{style:{flex:"0"},selected:a.value,"onUpdate:selected":l[1]||(l[1]=o=>a.value=o),options:[2,4,8]},null,8,["selected"])]),_:1,__:[4]})]),_:1}),p(T,null,{default:d(()=>[p(b,{"-justify":"flex-start",style:{padding:"7px"}},{default:d(()=>l[5]||(l[5]=[i("p",null,"改行時にインデントを保持する",-1)])),_:1,__:[5]})]),_:1})]),_:1})]),_:1})]),_:1},16,["shown"]))}},et=y(Ze,[["__scopeId","data-v-c71a2191"]]),tt=(t,e)=>({label:t,items:e}),M=(t,e,n)=>({label:t,command:e,bind:{separate:n}}),nt={txt:"text/plain",json:"application/json",js:"application/javascript",jsx:"text/jsx",ts:"application/typescript",tsx:"text/tsx",html:"text/html",css:"text/css",csv:"text/csv",xml:"application/xml",md:"text/markdown",pdf:"application/pdf",png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg",gif:"image/gif",bmp:"image/bmp",webp:"image/webp",svg:"image/svg+xml",mp3:"audio/mpeg",wav:"audio/wav",mp4:"video/mp4",mov:"video/quicktime",avi:"video/x-msvideo",zip:"application/zip",tar:"application/x-tar",gz:"application/gzip",rar:"application/vnd.rar",exe:"application/octet-stream",bin:"application/octet-stream"},st=t=>{if(!t)return"application/octet-stream";const e=t.toLowerCase();return nt[e]??"application/octet-stream"},W=async t=>{const e=URL.createObjectURL(await t.to_blob()),n=document.createElement("a");n.download=t.get_filename(),n.href=e,n.click(),URL.revokeObjectURL(e)},at=async()=>{const[t]=await window.showOpenFilePicker(),e=await t.getFile();return await{data:await e.text(),filename:e.name}};class ie{constructor(e){this.filename=g(e),this.created_at=new Date,this.data={},this.extension="nf",this.created_application="hq"}get_filename(){return this.filename+"."+this.extension}async to_blob(){const e=JSON.stringify({filename:this.filename,created_at:this.created_at,data:this.data});return new Blob([e],{type:this.get_mime()})}async from_blob(e){const n=new FileReader;return new Promise((a,s)=>{n.onload=()=>{try{const u=JSON.parse(n.result);this.data=u.data,this.filename=u.filename,this.created_at=new Date(u.created_at),a(u)}catch{s("failed parse a file.")}},n.onerror=()=>{s(n.error)},n.readAsText(e)})}get_mime(){return"application/octet-stream"}}const lt=t=>{const e=t.lastIndexOf(".");return e!==-1?t.substring(0,e):t},ot=t=>{const e=t.lastIndexOf(".");return e!==-1?t.substring(e+1):""},it=async t=>{const e=await at();try{const a=JSON.parse(e.data);if(se.short in a){const s=new rt(lt(e.filename));return Object.assign(s.data,a),Object.assign(t,s),s}}catch{}const n=new re(e.filename);return n.data.value=e.data,Object.assign(t,n),n};class rt extends ie{constructor(e){super(e),this.extension="nfe",this.created_application=se.short,this.data=F({content:""})}}class re extends ie{constructor(e){super(e),this.extension=ot(e),this.created_application="UNKNOWN",this.data=g("")}async to_blob(){return new Blob([this.data])}get_mime(){return st(this.extension)}}const ut={__name:"saveas",props:{shown:{},shownModifiers:{},filename:{},filenameModifiers:{}},emits:te(["save_as"],["update:shown","update:filename"]),setup(t){const e=S(t,"shown"),n=S(t,"filename");return(a,s)=>(r(),C(z,{shown:e.value,"onUpdate:shown":s[3]||(s[3]=u=>e.value=u),show_buttons:!1},{default:d(()=>[p(D,{justify:"start",spacing:14,style:{padding:"7px"}},{default:d(()=>s[4]||(s[4]=[i("h2",null,"名前をつけて保存",-1)])),_:1,__:[4]}),p(b,{style:{padding:"7px"},"-spacing":14},{default:d(()=>[i("button",{onClick:s[0]||(s[0]=u=>e.value=!1)},"キャンセル"),U(i("input",{type:"text","onUpdate:modelValue":s[1]||(s[1]=u=>n.value=u)},null,512),[[ee,n.value]]),i("button",{class:"primary",onClick:s[2]||(s[2]=u=>a.$emit("save_as"))},"保存")]),_:1})]),_:1},8,["shown"]))}},dt=y(ut,[["__scopeId","data-v-df96dccc"]]),ct={style:{width:"4rem",overflow:"hidden","white-space":"nowrap","text-overflow":"ellipsis"}},ft={__name:"edit",setup(t){const e=g(!1),n=g(!1),a=g(!1),s=F(new re("untitle")),u=F([tt("ファイル",[M("開く",()=>it(s)),M("保存",()=>W(s)),M("名前をつけて保存",()=>a.value=!0,"none"),M("環境設定",()=>n.value=!0,"above"),M("閉じる",()=>he.back(),"above")])]);return(l,o)=>(r(),C(we,null,{default:d(()=>[p(je,{onHelp:o[0]||(o[0]=c=>e.value=!0),style:{position:"fixed","z-index":"9999999"}},{default:d(()=>[i("strong",ct,v(s.filename),1),(r(!0),m($,null,N(u,c=>(r(),C(Se,{label:c.label,key:c},{default:d(()=>[(r(!0),m($,null,N(c.items,f=>(r(),C(Me,ne({ref_for:!0},f.bind,{onMenu_click:f.command,key:f}),{default:d(()=>[V(v(f.label),1)]),_:2},1040,["onMenu_click"]))),128))]),_:2},1032,["label"]))),128))]),_:1}),p(b,{style:{position:"fixed",inset:"0",top:"35px"},"-spacing":"0"},{default:d(()=>[p(He,{modelValue:s.data,"onUpdate:modelValue":o[1]||(o[1]=c=>s.data=c)},null,8,["modelValue"])]),_:1}),p(qe,{shown:e.value,"onUpdate:shown":o[2]||(o[2]=c=>e.value=c)},null,8,["shown"]),p(et,{shown:n.value,"onUpdate:shown":o[3]||(o[3]=c=>n.value=c)},null,8,["shown"]),p(dt,{shown:a.value,"onUpdate:shown":o[4]||(o[4]=c=>a.value=c),filename:s.filename,"onUpdate:filename":o[5]||(o[5]=c=>s.filename=c),onSave_as:o[6]||(o[6]=()=>ge(W)(s))},null,8,["shown","filename"])]),_:1}))}};export{ft as default};
