import{_ as v,c as L,a as m,o as p,r as h,n as H,b as _,d as x,w as o,e as c,f as r,g as D,t as y,p as ae,i as q,V as E,h as K,A as w,E as T,T as A,j as z,u as $,k as W,l as le,m as O,v as Q,M as N,q as oe,s as X,x as ie,y as R,z as re,F as M,B as V,C as Y,D as ue,G as Z,H as B,I as de,J as pe,K as ce}from"./index-BDqoLVNn.js";const fe={__name:"Hstack",props:{Spacing:[Number,String],Align:String,Justify:String},setup(t){const e=t,n=L(()=>({display:"flex",flexDirection:"row",alignItems:e.Align||"center",justifyContent:e.Justify||"center",gap:e.Spacing+"px"||0}));return(s,a)=>(p(),m("div",{class:"h-stack",style:H(n.value)},[h(s.$slots,"default",{},void 0,!0)],4))}},g=v(fe,[["__scopeId","data-v-458f31d9"]]),me={},_e={class:"material-symbols-rounded"};function ve(t,e){return p(),m("span",_e,[h(t.$slots,"default",{},void 0,!0)])}const P=v(me,[["render",ve],["__scopeId","data-v-cba4735d"]]),ge={class:"menu-buttons"},we={__name:"MenuBar",emits:["help"],setup(t){const e=_(!0),n=_(null);return ae("menu_manager",{openID:n,open(s){n.value=n.value===s?null:s},close(){n.value=null}}),(s,a)=>(p(),x(g,{class:"menu-bar blurred","-justify":"left"},{default:o(()=>[c("div",ge,[r(g,{"-justify":"left",style:{width:"100vw"}},{default:o(()=>[r(g,{"-justify":"left","-spacing":"14",style:{flex:"1"}},{default:o(()=>[h(s.$slots,"default",{},void 0,!0)]),_:3}),r(g,{style:{flex:"0","padding-right":"24px"},"-spacing":"14"},{default:o(()=>[r(P,{onClick:a[0]||(a[0]=i=>s.$emit("help"))},{default:o(()=>a[2]||(a[2]=[D("help")])),_:1,__:[2]}),r(P,{onClick:a[1]||(a[1]=i=>e.value=!e.value)},{default:o(()=>[D(y(e.value?"keep":"keep_off"),1)]),_:1})]),_:1})]),_:3})])]),_:3}))}},xe=v(we,[["__scopeId","data-v-83c104e1"]]),be=()=>crypto.randomUUID?.()||("10000000-1000-4000-8000"+-1e11).replace(/[018]/g,t=>(t^crypto.getRandomValues(new Uint8Array(1))[0]&15>>t/4).toString(16)),ye={class:"menu-wrapper"},he={__name:"MenuButton",props:["label"],setup(t){const e=t,n=_(be()),s=q("menu_manager"),a=L(()=>s.openID.value===n.value),i=()=>{s.open(n.value)};return(u,l)=>(p(),m("div",ye,[c("button",{class:"menu-button",onClick:l[0]||(l[0]=d=>i())},y(e.label),1),c("div",{class:K(["menu-list blurred",{open:a.value}])},[r(E,{justify:"flex-start"},{default:o(()=>[h(u.$slots,"default",{},void 0,!0)]),_:3})],2)]))}},ke=v(he,[["__scopeId","data-v-039af5d5"]]),$e={__name:"MenuItem",props:{key_bind:Object,separate:{default(){return"none"},validator(t,e){return["above","bellow","none"].includes(t)}}},emits:["menu_click"],setup(t,{emit:e}){const n=t,s=e,a=q("menu_manager"),i=()=>{a.close(),s("menu_click")};return(u,l)=>(p(),m("span",{class:K([n.separate,"menu-item"]),onClick:i},[h(u.$slots,"default",{},void 0,!0)],2))}},je=v($e,[["__scopeId","data-v-5be2fc5c"]]),Ee=(t,e,n)=>{if(!["Enter","Tab"].includes(t.key))return;const s=e.value;if(!s)return;const a=s.value,i=s.selectionStart,u=a.slice(0,i),l=a.slice(i),d=w.apps.Editor.indent_char==T.indent_char.Space?" ".repeat(A[w.apps.Editor.space_len]):"	";if(t.key==="Tab")t.preventDefault(),n.value=u+d+l,z(()=>s.selectionStart=s.selectionEnd=i+d.length);else if(t.key==="Enter"){t.preventDefault();const f=u.split(`
`),S=f[f.length-1];let k="";for(const b of S)if(b===" "||b==="	")k+=b;else break;let I=`
`;if(w.apps.Editor.indent_char===T.indent_char.Space){const b=k.split("").filter(se=>se===" ").length,U=Math.floor(b/A[w.apps.Editor.space_len]);I+=d.repeat(U)}else{const b=k.split("").filter(U=>U==="	").length;I+=d.repeat(b)}const F=f.join(`
`)+I;n.value=F+l,z(()=>s.selectionStart=s.selectionEnd=F.length)}},Se={__name:"editor",props:{modelValue:{},modelModifiers:{}},emits:["update:modelValue"],setup(t){const e=_(null),n=$(t,"modelValue"),s=a=>Ee(a,e,n);return W(()=>{e.value.focus(),e.value.addEventListener("keydown",s)}),le(()=>{e.value.removeEventListener("keydown",s)}),(a,i)=>O((p(),m("textarea",{id:"editor",ref_key:"editor",ref:e,"onUpdate:modelValue":i[0]||(i[0]=u=>n.value=u)},null,512)),[[Q,n.value]])}},Ie=v(Se,[["__scopeId","data-v-7c83ebf1"]]),Ce="/Neffice/edit.svg",Ue={__name:"about",props:{shown:{},shownModifiers:{}},emits:["update:shown"],setup(t){const e=$(t,"shown");return(n,s)=>(p(),x(N,{shown:e.value,"onUpdate:shown":s[0]||(s[0]=a=>e.value=a)},{default:o(()=>[r(E,{style:{padding:"7px"}},{default:o(()=>s[1]||(s[1]=[c("img",{src:Ce,width:"150px"},null,-1),c("h1",null,"Edit",-1),c("p",null,"ブラウザ上で動作するシンプルなテキストエディタ。",-1),c("br",null,null,-1),c("small",null,"Built with Vue.js",-1)])),_:1,__:[1]})]),_:1},8,["shown"]))}},De={style:{width:"100%"}},Me={key:0},Ve={__name:"groupBox",props:["header","bg"],setup(t){const e=t;return(n,s)=>(p(),m("div",De,[e.header?(p(),m("small",Me,y(e.header),1)):oe("",!0),c("div",{class:"group",style:H({backgroundColor:e.bg??"var(--colour-foreground)"})},[h(n.$slots,"default",{},void 0,!0)],4)]))}},ee=v(Ve,[["__scopeId","data-v-60daa9a3"]]),Be={__name:"ListItem",emits:["click"],setup(t){return(e,n)=>(p(),m("div",{class:"listitem",onClick:n[0]||(n[0]=s=>e.$emit("click"))},[h(e.$slots,"default",{},void 0,!0)]))}},C=v(Be,[["__scopeId","data-v-3fa901d1"]]),Le={style:{padding:"7px"}},Oe={__name:"PullDown",props:X(["options"],{selected:{},selectedModifiers:{}}),emits:["update:selected"],setup(t){const e=t,n=$(t,"selected"),s=_(!1),a=L(()=>e.options[n.value]??"選択してください"),i=d=>{n.value=d,s.value=!1},u=_(null),l=d=>{u.value&&!u.value.contains(d.target)&&(s.value=!1)};return W(()=>{document.addEventListener("click",l)}),ie(()=>{document.removeEventListener("click",l)}),(d,f)=>(p(),m("div",{class:"border",ref_key:"DropDown_ref",ref:u},[r(g,{spacing:10,onClick:[f[0]||(f[0]=S=>s.value=!0),f[1]||(f[1]=R(()=>{},["stop"]))]},{default:o(()=>[(p(),m("div",{style:{"min-width":"85px",width:"max-content"},key:n.value},y(a.value),1)),f[3]||(f[3]=c("div",{class:"triangle"},null,-1))]),_:1,__:[3]}),O(r(E,{class:"options blurred",align:"start",onClick:f[2]||(f[2]=R(()=>{},["stop"]))},{default:o(()=>[r(ee,{bg:"transparent"},{default:o(()=>[(p(!0),m(M,null,V(e.options,(S,k)=>(p(),x(C,{key:k,onClick:I=>i(k)},{default:o(()=>[c("div",Le,y(S),1)]),_:2},1032,["onClick"]))),128))]),_:1})]),_:1},512),[[re,s.value]])],512))}},J=v(Oe,[["__scopeId","data-v-18dce54b"]]),Ne={__name:"settings",props:{shown:{},shownModifiers:{}},emits:["update:shown"],setup(t){const e=$(t,"shown"),n=_(w.apps.Editor.indent_char),s=_(w.apps.Editor.space_len),a={footerButtons:[{label:"キャンセル",onClick:()=>{e.value=!1}},{label:"保存",type:"primary",onClick:()=>{w.apps.Editor.indent_char=n.value,w.apps.Editor.space_len=s.value,ue(),e.value=!1}}]};return(i,u)=>(p(),x(N,Y({shown:e.value,"onUpdate:shown":u[2]||(u[2]=l=>e.value=l)},a),{default:o(()=>[r(E,{class:"modal"},{default:o(()=>[r(ee,{header:"エディタ"},{default:o(()=>[r(C,null,{default:o(()=>[r(g,{"-justify":"flex-start",style:{padding:"7px"}},{default:o(()=>[u[3]||(u[3]=c("p",{style:{flex:"1"}},"タブの種類",-1)),r(J,{style:{flex:"0"},selected:n.value,"onUpdate:selected":u[0]||(u[0]=l=>n.value=l),options:["タブ文字","スペース"]},null,8,["selected"])]),_:1,__:[3]})]),_:1}),r(C,null,{default:o(()=>[r(g,{"-justify":"flex-start",style:{padding:"7px"}},{default:o(()=>[u[4]||(u[4]=c("p",{style:{flex:"1"}},"タブの文字数",-1)),r(J,{style:{flex:"0"},selected:s.value,"onUpdate:selected":u[1]||(u[1]=l=>s.value=l),options:[2,4,8]},null,8,["selected"])]),_:1,__:[4]})]),_:1}),r(C,null,{default:o(()=>[r(g,{"-justify":"flex-start",style:{padding:"7px"}},{default:o(()=>u[5]||(u[5]=[c("p",null,"改行時にインデントを保持する",-1)])),_:1,__:[5]})]),_:1})]),_:1})]),_:1})]),_:1},16,["shown"]))}},Fe=v(Ne,[["__scopeId","data-v-c71a2191"]]),Te=(t,e)=>({label:t,items:e}),j=(t,e,n)=>({label:t,command:e,bind:{separate:n}}),Ae={txt:"text/plain",json:"application/json",js:"application/javascript",jsx:"text/jsx",ts:"application/typescript",tsx:"text/tsx",html:"text/html",css:"text/css",csv:"text/csv",xml:"application/xml",md:"text/markdown",pdf:"application/pdf",png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg",gif:"image/gif",bmp:"image/bmp",webp:"image/webp",svg:"image/svg+xml",mp3:"audio/mpeg",wav:"audio/wav",mp4:"video/mp4",mov:"video/quicktime",avi:"video/x-msvideo",zip:"application/zip",tar:"application/x-tar",gz:"application/gzip",rar:"application/vnd.rar",exe:"application/octet-stream",bin:"application/octet-stream"},ze=t=>{if(!t)return"application/octet-stream";const e=t.toLowerCase();return Ae[e]??"application/octet-stream"},G=async t=>{const e=URL.createObjectURL(await t.to_blob()),n=document.createElement("a");n.download=t.get_filename(),n.href=e,n.click(),URL.revokeObjectURL(e)},Re=async()=>{const[t]=await window.showOpenFilePicker(),e=await t.getFile();return await{data:await e.text(),filename:e.name}};class te{constructor(e){this.filename=_(e),this.created_at=new Date,this.data={},this.extension="nf",this.created_application="hq"}get_filename(){return this.filename+"."+this.extension}async to_blob(){const e=JSON.stringify({filename:this.filename,created_at:this.created_at,data:this.data});return new Blob([e],{type:this.get_mime()})}async from_blob(e){const n=new FileReader;return new Promise((s,a)=>{n.onload=()=>{try{const i=JSON.parse(n.result);this.data=i.data,this.filename=i.filename,this.created_at=new Date(i.created_at),s(i)}catch{a("failed parse a file.")}},n.onerror=()=>{a(n.error)},n.readAsText(e)})}get_mime(){return"application/octet-stream"}}const Pe=t=>{const e=t.lastIndexOf(".");return e!==-1?t.substring(0,e):t},Je=t=>{const e=t.lastIndexOf(".");return e!==-1?t.substring(e+1):""},Ge=async t=>{const e=await Re();try{const s=JSON.parse(e.data);if(Z.short in s){const a=new He(Pe(e.filename));return Object.assign(a.data,s),Object.assign(t,a),a}}catch{}const n=new ne(e.filename);return n.data.value=e.data,Object.assign(t,n),n};class He extends te{constructor(e){super(e),this.extension="nfe",this.created_application=Z.short,this.data=B({content:""})}}class ne extends te{constructor(e){super(e),this.extension=Je(e),this.created_application="UNKNOWN",this.data=_("")}async to_blob(){return new Blob([this.data])}get_mime(){return ze(this.extension)}}const qe={__name:"saveas",props:{shown:{},shownModifiers:{},filename:{},filenameModifiers:{}},emits:X(["save_as"],["update:shown","update:filename"]),setup(t){const e=$(t,"shown"),n=$(t,"filename");return(s,a)=>(p(),x(N,{shown:e.value,"onUpdate:shown":a[3]||(a[3]=i=>e.value=i),show_buttons:!1},{default:o(()=>[r(E,{justify:"start",spacing:14,style:{padding:"7px"}},{default:o(()=>a[4]||(a[4]=[c("h2",null,"名前をつけて保存",-1)])),_:1,__:[4]}),r(g,{style:{padding:"7px"},"-spacing":14},{default:o(()=>[c("button",{onClick:a[0]||(a[0]=i=>e.value=!1)},"キャンセル"),O(c("input",{type:"text","onUpdate:modelValue":a[1]||(a[1]=i=>n.value=i)},null,512),[[Q,n.value]]),c("button",{class:"primary",onClick:a[2]||(a[2]=i=>s.$emit("save_as"))},"保存")]),_:1})]),_:1},8,["shown"]))}},Ke=v(qe,[["__scopeId","data-v-df96dccc"]]),We={style:{width:"4rem",overflow:"hidden","white-space":"nowrap","text-overflow":"ellipsis"}},Xe={__name:"edit",setup(t){const e=_(!1),n=_(!1),s=_(!1),a=B(new ne("untitle")),i=B([Te("ファイル",[j("開く",()=>Ge(a)),j("保存",()=>G(a)),j("名前をつけて保存",()=>s.value=!0,"none"),j("環境設定",()=>n.value=!0,"above"),j("閉じる",()=>ce.back(),"above")])]);return(u,l)=>(p(),x(pe,null,{default:o(()=>[r(xe,{onHelp:l[0]||(l[0]=d=>e.value=!0),style:{position:"fixed","z-index":"9999999"}},{default:o(()=>[c("strong",We,y(a.filename),1),(p(!0),m(M,null,V(i,d=>(p(),x(ke,{label:d.label,key:d},{default:o(()=>[(p(!0),m(M,null,V(d.items,f=>(p(),x(je,Y({ref_for:!0},f.bind,{onMenu_click:f.command,key:f}),{default:o(()=>[D(y(f.label),1)]),_:2},1040,["onMenu_click"]))),128))]),_:2},1032,["label"]))),128))]),_:1}),r(g,{style:{position:"fixed",inset:"0",top:"35px"},"-spacing":"0"},{default:o(()=>[r(Ie,{modelValue:a.data,"onUpdate:modelValue":l[1]||(l[1]=d=>a.data=d)},null,8,["modelValue"])]),_:1}),r(Ue,{shown:e.value,"onUpdate:shown":l[2]||(l[2]=d=>e.value=d)},null,8,["shown"]),r(Fe,{shown:n.value,"onUpdate:shown":l[3]||(l[3]=d=>n.value=d)},null,8,["shown"]),r(Ke,{shown:s.value,"onUpdate:shown":l[4]||(l[4]=d=>s.value=d),filename:a.filename,"onUpdate:filename":l[5]||(l[5]=d=>a.filename=d),onSave_as:l[6]||(l[6]=()=>de(G)(a))},null,8,["shown","filename"])]),_:1}))}};export{Xe as default};
