import{_ as h,c,o as r,a as l,r as N,u as U,b as _,d as A,e as R,f as p,g as D,w as f,h as L,t as d,B as T,i as E,v as j,n as V,T as O,j as b,k as x,l as q,m as K,F as w,p as z,q as u,s as H,x as Q}from"./index-8XxE1wwC.js";const G={},J={class:"menu-bar-parent"},W={class:"menu-bar"};function X(o,t){return r(),c("div",J,[l("div",W,[N(o.$slots,"default",{},void 0)])])}const Y=h(G,[["render",X],["__scopeId","data-v-0d7c48c2"]]),Z={class:"menu-bar-button"},ee={__name:"MenuBarButton",props:["label"],setup(o){const t=U("menuButton"),e=_(null),n=_(!1);A(()=>{window.addEventListener("click",i)});const s=()=>{const a=t.value.el.getClientRects();e.value=a[0].left+"px"};R(()=>{window.removeEventListener("click",i)});const i=a=>{s(),a.target==t.value.el?n.value=!n.value:n.value=!1};return(a,m)=>(r(),c("div",Z,[p(T,{variant:"simple",ref_key:"menuButton",ref:t},{default:f(()=>[L(d(o.label),1)]),_:1},512),(r(),D(O,{defer:"",to:".menu-bar-parent"},[E(l("div",{class:"blur",style:V({left:e.value})},[N(a.$slots,"default",{},void 0)],4),[[j,n.value]])]))]))}},te=h(ee,[["__scopeId","data-v-bf194022"]]),ne={Ctrl:"ctrl",Control:"ctrl",Alt:"alt",Shift:"shift",A:"a",B:"b",C:"c",D:"d",E:"e",F:"f",G:"g",H:"h",I:"i",J:"j",K:"k",L:"l",M:"m",N:"n",O:"o",P:"p",Q:"q",R:"r",S:"s",T:"t",U:"u",V:"v",W:"w",X:"x",Y:"y",Z:"z",0:"0",1:"1",2:"2",3:"3",4:"4",5:"5",6:"6",7:"7",8:"8",9:"9",Numpad0:"num0",Numpad1:"num1",Numpad2:"num2",Numpad3:"num3",Numpad4:"num4",Numpad5:"num5",Numpad6:"num6",Numpad7:"num7",Numpad8:"num8",Numpad9:"num9",NumpadAdd:"+",NumpadSubtract:"-",NumpadMultiply:"*",NumpadDivide:"/",NumpadDecimal:".",NumpadEnter:"enter","`":"`","-":"-","=":"=","[":"[","]":"]",";":";","'":"'",",":",",".":".","/":"/",Enter:"enter",Tab:"tab",Backspace:"backspace",Delete:"delete",Insert:"insert",Escape:"esc",Space:"space",ArrowUp:"up",ArrowDown:"down",ArrowLeft:"left",ArrowRight:"right",F1:"f1",F2:"f2",F3:"f3",F4:"f4",F5:"f5",F6:"f6",F7:"f7",F8:"f8",F9:"f9",F10:"f10",F11:"f11",F12:"f12",CapsLock:"capslock",NumLock:"numlock",ScrollLock:"scrolllock",PrintScreen:"printscreen",Pause:"pause",ContextMenu:"menu",PageUp:"pageup",PageDown:"pagedown",Home:"home",End:"end"},se=Object.keys(ne),ae={class:"label"},oe={class:"key"},ie={__name:"MenuBarButtonItem",props:{keyBind:{type:Array,default:()=>[],validator(o){return o.every(t=>se.includes(t))}},handler:{type:Function,default:()=>{}}},setup(o){const t=o,e=_(t.keyBind),n=s=>{s.preventDefault(),t.handler()};return(s,i)=>(r(),c("div",{class:"item",onClick:n},[l("div",ae,[N(s.$slots,"default",{},void 0)]),l("div",oe,d(e.value?.join(" + ")),1)]))}},B=h(ie,[["__scopeId","data-v-9baae584"]]),le={},re={class:"devide"};function ce(o,t){return r(),c("div",re)}const M=h(le,[["render",ce],["__scopeId","data-v-299b7c29"]]),ue=(o=["*"],t=!1)=>{const e=document.createElement("input");e.setAttribute("type","file"),e.setAttribute("accept",o.join(",")),t&&(e.multiple=!0),e.click()},de=(o,t="text/plain")=>{const e=new Blob([o],{type:t}),n=URL.createObjectURL(e);return{fileURL:n,discardURL:()=>URL.revokeObjectURL(n)}};class I{constructor(){this.filename=b.data.edit.file.default_name??"no_name",this.extension="txt",this.data=x([""]),this.compositing=_(""),this.lineLength=x([0]),this.historyStack=[],this.historyCounter=0,this._prefixSum=[0],this.carretPos=x({line:0,pos:0})}onChange(t){if(typeof t!="string")return;const e=t.replace(/\r\n/g,`
`).split(`
`),n=this.data,s=this.lineLength,i=Math.min(n.length,e.length);for(let a=0;a<i;a++)n[a]!==e[a]&&(n[a]=e[a],s[a]=e[a].length);if(e.length>n.length){const a=e.slice(n.length);n.push(...a),s.push(...a.map(m=>m.length))}else e.length<n.length&&(n.splice(e.length),s.splice(e.length));this._updatePrefixSum()}_updatePrefixSum(){const t=[];let e=0;for(let n=0;n<this.lineLength.length;n++)e+=this.lineLength[n]+1,t.push(e);this._prefixSum=t}updateCursor(t){if(!t?.value)return;const e=t.selectionEnd??0,n=this._binarySearchPrefix(e),s=e-(n>0?this._prefixSum[n-1]:0);this.carretPos.line=n,this.carretPos.pos=s}_binarySearchPrefix(t){const e=this._prefixSum;let n=0,s=e.length-1,i;for(;n<=s;)i=n+s>>1,t<e[i]?s=i-1:n=i+1;return n}save_to_local(){const t=de(this.data.join(`
`)),e=document.createElement("a");e.href=t.fileURL,e.download=`${this.filename}.${this.extension}`,e.click(),t.discardURL()}}const pe={class:"line"},me={class:"line-counter-container"},fe={class:"line-counter"},_e={class:"line-content-container"},he={key:1},ve={__name:"editor-area",props:{modelValue:{},modelModifiers:{}},emits:["update:modelValue"],setup(o){const t=q(o,"modelValue"),e=K("instance"),n=e.data,s=U("textarea"),i=e.carretPos,a=_(!1),m=_(!1),C=y=>{e.onChange(t.value),m.value||e.updateCursor(s.value)},S=()=>{s.value.focus(),a.value=!0},F=()=>a.value=!1,g=y=>{m.value=!0,e.compositing=y.data},$=()=>{e.compositing="",m.value=!1,e.updateCursor(s.value)};return A(()=>{s.value.addEventListener("input",C),s.value.addEventListener("focusout",F),s.value.addEventListener("compositionstart",g),s.value.addEventListener("compositionupdate",g),s.value.addEventListener("compositionend",$),S()}),R(()=>{s.value.removeEventListener("input",C),s.value.removeEventListener("focusout",F),s.value.removeEventListener("compositionstart",g),s.value.removeEventListener("compositionupdate",g),s.value.removeEventListener("compositionend",$)}),(y,k)=>(r(),c(w,null,[l("div",{class:"editor",onClick:S},[(r(!0),c(w,null,z(u(n),(v,P)=>(r(),c("div",null,[l("div",pe,[l("div",me,[l("div",fe,d(P+1),1)]),l("div",_e,[P===u(i).line?(r(),c(w,{key:0},[l("span",null,d(v.slice(0,u(i).pos)),1),l("span",null,d(u(e).compositing),1),E((r(),c("span",{class:"carret",key:u(i).pos},[...k[1]||(k[1]=[l("span",null,null,-1)])])),[[j,a.value]]),l("span",null,d(v.slice(u(i).pos)),1)],64)):(r(),c("span",he,d(v),1))])])]))),256))]),E(l("textarea",{"onUpdate:modelValue":k[0]||(k[0]=v=>t.value=v),ref:"textarea"},null,512),[[H,t.value]])],64))}},be=h(ve,[["__scopeId","data-v-957332b8"]]),ge={class:"app"},ke={__name:"edit",setup(o){const t=x(new I);Q("instance",t);const e=()=>{Object.assign(t,new I)};return(n,s)=>(r(),c("div",ge,[p(Y,null,{default:f(()=>[p(te,{label:u(b).data.edit.menubar.file.label},{default:f(()=>[p(B,{"key-bind":["Ctrl","N"],handler:e},{default:f(()=>[L(d(u(b).data.edit.menubar.file.start_with_new),1)]),_:1}),p(M),p(B,{"key-bind":["Ctrl","S"],handler:()=>t.save_to_local()},{default:f(()=>[L(d(u(b).data.edit.menubar.file.save_to_local),1)]),_:1},8,["handler"]),p(M),p(B,{"key-bind":["Ctrl","Q"],handler:()=>u(ue)(["*",!0])},{default:f(()=>[L(d(u(b).data.edit.menubar.file.quit),1)]),_:1},8,["handler"])]),_:1},8,["label"])]),_:1}),p(be)]))}},xe=h(ke,[["__scopeId","data-v-571ca9b6"]]);export{xe as default};
