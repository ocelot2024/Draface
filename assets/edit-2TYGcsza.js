import{_ as h,c as u,o as c,a as r,r as B,u as w,b as g,d as $,e as E,f as p,g as U,w as _,h as b,t as d,B as j,i as I,v as R,n as A,T as D,j as m,k as v,l as T,F as x,m as O,p as i,q as V}from"./index-D4gVe267.js";const q={},K={class:"menu-bar-parent"},z={class:"menu-bar"};function H(l,e){return c(),u("div",K,[r("div",z,[B(l.$slots,"default",{},void 0)])])}const Q=h(q,[["render",H],["__scopeId","data-v-0d7c48c2"]]),G={class:"menu-bar-button"},J={__name:"MenuBarButton",props:["label"],setup(l){const e=w("menuButton"),n=g(null),t=g(!1);$(()=>{window.addEventListener("click",o)});const s=()=>{const a=e.value.el.getClientRects();n.value=a[0].left+"px"};E(()=>{window.removeEventListener("click",o)});const o=a=>{s(),a.target==e.value.el?t.value=!t.value:t.value=!1};return(a,f)=>(c(),u("div",G,[p(j,{variant:"simple",ref_key:"menuButton",ref:e},{default:_(()=>[b(d(l.label),1)]),_:1},512),(c(),U(D,{defer:"",to:".menu-bar-parent"},[I(r("div",{class:"blur",style:A({left:n.value})},[B(a.$slots,"default",{},void 0)],4),[[R,t.value]])]))]))}},W=h(J,[["__scopeId","data-v-bf194022"]]),X={Ctrl:"ctrl",Control:"ctrl",Alt:"alt",Shift:"shift",A:"a",B:"b",C:"c",D:"d",E:"e",F:"f",G:"g",H:"h",I:"i",J:"j",K:"k",L:"l",M:"m",N:"n",O:"o",P:"p",Q:"q",R:"r",S:"s",T:"t",U:"u",V:"v",W:"w",X:"x",Y:"y",Z:"z",0:"0",1:"1",2:"2",3:"3",4:"4",5:"5",6:"6",7:"7",8:"8",9:"9",Numpad0:"num0",Numpad1:"num1",Numpad2:"num2",Numpad3:"num3",Numpad4:"num4",Numpad5:"num5",Numpad6:"num6",Numpad7:"num7",Numpad8:"num8",Numpad9:"num9",NumpadAdd:"+",NumpadSubtract:"-",NumpadMultiply:"*",NumpadDivide:"/",NumpadDecimal:".",NumpadEnter:"enter","`":"`","-":"-","=":"=","[":"[","]":"]",";":";","'":"'",",":",",".":".","/":"/",Enter:"enter",Tab:"tab",Backspace:"backspace",Delete:"delete",Insert:"insert",Escape:"esc",Space:"space",ArrowUp:"up",ArrowDown:"down",ArrowLeft:"left",ArrowRight:"right",F1:"f1",F2:"f2",F3:"f3",F4:"f4",F5:"f5",F6:"f6",F7:"f7",F8:"f8",F9:"f9",F10:"f10",F11:"f11",F12:"f12",CapsLock:"capslock",NumLock:"numlock",ScrollLock:"scrolllock",PrintScreen:"printscreen",Pause:"pause",ContextMenu:"menu",PageUp:"pageup",PageDown:"pagedown",Home:"home",End:"end"},Y=Object.keys(X),Z={class:"label"},ee={class:"key"},te={__name:"MenuBarButtonItem",props:{keyBind:{type:Array,default:()=>[],validator(l){return l.every(e=>Y.includes(e))}},handler:{type:Function,default:()=>{}}},setup(l){const e=l,n=g(e.keyBind),t=s=>{s.preventDefault(),e.handler()};return(s,o)=>(c(),u("div",{class:"item",onClick:t},[r("div",Z,[B(s.$slots,"default",{},void 0)]),r("div",ee,d(n.value?.join(" + ")),1)]))}},y=h(te,[["__scopeId","data-v-9baae584"]]),ne={},ae={class:"devide"};function se(l,e){return c(),u("div",ae)}const C=h(ne,[["render",se],["__scopeId","data-v-299b7c29"]]),oe=(l=["*"],e=!1)=>{const n=document.createElement("input");n.setAttribute("type","file"),n.setAttribute("accept",l.join(",")),e&&(n.multiple=!0),n.click()},le=(l,e="text/plain")=>{const n=new Blob([l],{type:e}),t=URL.createObjectURL(n);return{fileURL:t,discardURL:()=>URL.revokeObjectURL(t)}};class F{constructor(){this.filename=m.data.edit.file.default_name??"no_name",this.extension="txt",this.data=v([""]),this.lineLength=v([0]),this.historyStack=[],this.historyCounter=0,this._prefixSum=[0],this.carretPos=v({line:0,pos:0}),this.textareaPos=v({top:0,left:0})}onChange(e){if(typeof e!="string")return;const n=e.replace(/\r\n/g,`
`).split(`
`),t=this.data,s=this.lineLength,o=Math.min(t.length,n.length);for(let a=0;a<o;a++)t[a]!==n[a]&&(t[a]=n[a],s[a]=n[a].length);if(n.length>t.length){const a=n.slice(t.length);t.push(...a),s.push(...a.map(f=>f.length))}else n.length<t.length&&(t.splice(n.length),s.splice(n.length));this._updatePrefixSum()}_updatePrefixSum(){const e=[];let n=0;for(let t=0;t<this.lineLength.length;t++)n+=this.lineLength[t]+1,e.push(n);this._prefixSum=e}updateCursor(e,n){if(!e?.value)return;const t=e.selectionEnd??0,s=this._binarySearchPrefix(t),o=t-(s>0?this._prefixSum[s-1]:0);this.carretPos.line=s,this.carretPos.pos=o;const{top:a,left:f}=n.getBoundingClientRect();this.textareaPos={top:a}}_binarySearchPrefix(e){const n=this._prefixSum;let t=0,s=n.length-1,o;for(;t<=s;)o=t+s>>1,e<n[o]?s=o-1:t=o+1;return t}save_to_local(){const e=le(this.data.join(`
`)),n=document.createElement("a");n.href=e.fileURL,n.download=`${this.filename}.${this.extension}`,n.click(),e.discardURL()}}const re={class:"line"},ie={class:"line-counter-container"},ce={class:"line-counter"},ue={class:"line-content-container"},de={key:1},pe={__name:"editor-area",setup(l){const e=T("instance"),n=e.data,t=w("textarea"),s=w("carret_ref"),o=e.carretPos,a=g(!1),f=M=>{e.onChange(t.value.value),e.updateCursor(t.value,s.value[0])},L=()=>{t.value.focus(),a.value=!0},N=()=>a.value=!1;return $(()=>{t.value.addEventListener("input",f),t.value.addEventListener("focusout",N),L()}),E(()=>{t.value.removeEventListener("input",f),t.value.removeEventListener("focusout",N)}),(M,S)=>(c(),u(x,null,[r("div",{class:"editor",onClick:L},[(c(!0),u(x,null,O(i(n),(k,P)=>(c(),u("div",null,[r("div",re,[r("div",ie,[r("div",ce,d(P+1),1)]),r("div",ue,[P===i(o).line?(c(),u(x,{key:0},[r("span",null,d(k.slice(0,i(o).pos)),1),r("span",null,d(i(e).compositing),1),I((c(),u("span",{class:"carret",key:i(o).pos,ref_for:!0,ref_key:"carret_ref",ref:s},[...S[0]||(S[0]=[r("span",null,null,-1)])])),[[R,a.value]]),r("span",null,d(k.slice(i(o).pos)),1)],64)):(c(),u("span",de,d(k),1))])])]))),256))]),r("textarea",{ref:"textarea",style:A([{position:"fixed",width:"100%"},{top:i(e).textareaPos.top+"px",left:i(e).textareaPos.left+"px"}])},null,4)],64))}},fe=h(pe,[["__scopeId","data-v-157bfd2c"]]),_e={class:"app"},he={__name:"edit",setup(l){const e=v(new F);V("instance",e);const n=()=>{Object.assign(e,new F)};return(t,s)=>(c(),u("div",_e,[p(Q,null,{default:_(()=>[p(W,{label:i(m).data.edit.menubar.file.label},{default:_(()=>[p(y,{"key-bind":["Ctrl","N"],handler:n},{default:_(()=>[b(d(i(m).data.edit.menubar.file.start_with_new),1)]),_:1}),p(C),p(y,{"key-bind":["Ctrl","S"],handler:()=>e.save_to_local()},{default:_(()=>[b(d(i(m).data.edit.menubar.file.save_to_local),1)]),_:1},8,["handler"]),p(C),p(y,{"key-bind":["Ctrl","Q"],handler:()=>i(oe)(["*",!0])},{default:_(()=>[b(d(i(m).data.edit.menubar.file.quit),1)]),_:1},8,["handler"])]),_:1},8,["label"])]),_:1}),p(fe)]))}},ve=h(he,[["__scopeId","data-v-571ca9b6"]]);export{ve as default};
