import{_ as h,c as u,o as c,a as l,r as w,u as S,b as g,d as E,e as I,f as p,g as D,w as f,h as b,t as d,B as j,i as R,v as M,n as U,T,j as v,k as _,l as O,F as x,m as V,p as r,q,s as K}from"./index-CxLxzPjT.js";const z={},H={class:"menu-bar-parent"},Q={class:"menu-bar"};function G(i,t){return c(),u("div",H,[l("div",Q,[w(i.$slots,"default",{},void 0)])])}const J=h(z,[["render",G],["__scopeId","data-v-0d7c48c2"]]),W={class:"menu-bar-button"},X={__name:"MenuBarButton",props:["label"],setup(i){const t=S("menuButton"),n=g(null),e=g(!1);E(()=>{window.addEventListener("click",o)});const s=()=>{const a=t.value.el.getClientRects();n.value=a[0].left+"px"};I(()=>{window.removeEventListener("click",o)});const o=a=>{s(),a.target==t.value.el?e.value=!e.value:e.value=!1};return(a,m)=>(c(),u("div",W,[p(j,{variant:"simple",ref_key:"menuButton",ref:t},{default:f(()=>[b(d(i.label),1)]),_:1},512),(c(),D(T,{defer:"",to:".menu-bar-parent"},[R(l("div",{class:"blur",style:U({left:n.value})},[w(a.$slots,"default",{},void 0)],4),[[M,e.value]])]))]))}},Y=h(X,[["__scopeId","data-v-bf194022"]]),Z={Ctrl:"ctrl",Control:"ctrl",Alt:"alt",Shift:"shift",A:"a",B:"b",C:"c",D:"d",E:"e",F:"f",G:"g",H:"h",I:"i",J:"j",K:"k",L:"l",M:"m",N:"n",O:"o",P:"p",Q:"q",R:"r",S:"s",T:"t",U:"u",V:"v",W:"w",X:"x",Y:"y",Z:"z",0:"0",1:"1",2:"2",3:"3",4:"4",5:"5",6:"6",7:"7",8:"8",9:"9",Numpad0:"num0",Numpad1:"num1",Numpad2:"num2",Numpad3:"num3",Numpad4:"num4",Numpad5:"num5",Numpad6:"num6",Numpad7:"num7",Numpad8:"num8",Numpad9:"num9",NumpadAdd:"+",NumpadSubtract:"-",NumpadMultiply:"*",NumpadDivide:"/",NumpadDecimal:".",NumpadEnter:"enter","`":"`","-":"-","=":"=","[":"[","]":"]",";":";","'":"'",",":",",".":".","/":"/",Enter:"enter",Tab:"tab",Backspace:"backspace",Delete:"delete",Insert:"insert",Escape:"esc",Space:"space",ArrowUp:"up",ArrowDown:"down",ArrowLeft:"left",ArrowRight:"right",F1:"f1",F2:"f2",F3:"f3",F4:"f4",F5:"f5",F6:"f6",F7:"f7",F8:"f8",F9:"f9",F10:"f10",F11:"f11",F12:"f12",CapsLock:"capslock",NumLock:"numlock",ScrollLock:"scrolllock",PrintScreen:"printscreen",Pause:"pause",ContextMenu:"menu",PageUp:"pageup",PageDown:"pagedown",Home:"home",End:"end"},ee=Object.keys(Z),te={class:"label"},ne={class:"key"},se={__name:"MenuBarButtonItem",props:{keyBind:{type:Array,default:()=>[],validator(i){return i.every(t=>ee.includes(t))}},handler:{type:Function,default:()=>{}}},setup(i){const t=i,n=g(t.keyBind),e=s=>{s.preventDefault(),t.handler()};return(s,o)=>(c(),u("div",{class:"item",onClick:e},[l("div",te,[w(s.$slots,"default",{},void 0)]),l("div",ne,d(n.value?.join(" + ")),1)]))}},y=h(se,[["__scopeId","data-v-9baae584"]]),ae={},oe={class:"devide"};function le(i,t){return c(),u("div",oe)}const $=h(ae,[["render",le],["__scopeId","data-v-299b7c29"]]),ie=(i,t="text/plain")=>{const n=new Blob([i],{type:t}),e=URL.createObjectURL(n);return{fileURL:e,discardURL:()=>URL.revokeObjectURL(e)}};class F{constructor(){this.filename=v.data.edit.file.default_name??"no_name",this.extension="txt",this.data=_([""]),this.lineLength=_([0]),this.historyStack=[],this.historyCounter=0,this._prefixSum=[0],this.carretPos=_({line:0,pos:0}),this.textareaPos=_({top:0,left:0}),this.selectionStart=_({line:0,pos:0})}onChange(t){if(typeof t!="string")return;const n=t.replace(/\r\n/g,`
`).split(`
`),e=this.data,s=this.lineLength,o=Math.min(e.length,n.length);for(let a=0;a<o;a++)e[a]!==n[a]&&(e[a]=n[a],s[a]=n[a].length);if(n.length>e.length){const a=n.slice(e.length);e.push(...a),s.push(...a.map(m=>m.length))}else n.length<e.length&&(e.splice(n.length),s.splice(n.length));this._updatePrefixSum()}_updatePrefixSum(){const t=[];let n=0;for(let e=0;e<this.lineLength.length;e++)n+=this.lineLength[e]+1,t.push(n);this._prefixSum=t}updateCursor(t,n){if(!t?.value)return;const e=t.selectionEnd??0,s=this._binarySearchPrefix(e),o=e-(s>0?this._prefixSum[s-1]:0);if(this.carretPos.line=s,this.carretPos.pos=o,!n)return;const{top:a,left:m}=n.getBoundingClientRect();this.textareaPos={top:a}}_binarySearchPrefix(t){const n=this._prefixSum;let e=0,s=n.length-1,o;for(;e<=s;)o=e+s>>1,t<n[o]?s=o-1:e=o+1;return e}save_to_local(){const t=ie(this.data.join(`
`)),n=document.createElement("a");n.href=t.fileURL,n.download=`${this.filename}.${this.extension}`,n.click(),t.discardURL()}updateSelection(t){if(!t.value)return;this.updateCursor(t);const n=t.selectionStart,e=this._binarySearchPrefix(n),s=n-(e>0?this._prefixSum[e-1]:0);this.selectionStart.line=e,this.selectionStart.pos=s,console.log(this.selectionStart)}}const re={class:"line"},ce={class:"line-counter-container"},ue={class:"line-counter"},de={class:"line-content-container"},pe={key:1},fe={__name:"editor-area",setup(i){const t=O("instance"),n=t.data,e=S("textarea"),s=S("carret_ref"),o=t.carretPos,a=g(!1),m=()=>{t.updateSelection(e.value)},L=A=>{t.onChange(e.value.value),t.updateCursor(e.value,s.value[0])},B=()=>{e.value.focus(),a.value=!0},N=()=>a.value=!1;return E(()=>{e.value.addEventListener("input",L),e.value.addEventListener("focusout",N),e.value.addEventListener("selectionchange",m),B()}),I(()=>{e.value.removeEventListener("input",L),e.value.removeEventListener("focusout",N)}),(A,P)=>(c(),u(x,null,[l("div",{class:"editor",onClick:B},[(c(!0),u(x,null,V(r(n),(k,C)=>(c(),u("div",null,[l("div",re,[l("div",ce,[l("div",ue,d(C+1),1)]),l("div",de,[C===r(o).line?(c(),u(x,{key:0},[l("span",null,d(k.slice(0,r(o).pos)),1),l("span",null,d(r(t).compositing),1),R((c(),u("span",{class:"carret",key:r(o).pos,ref_for:!0,ref_key:"carret_ref",ref:s},[...P[0]||(P[0]=[l("span",null,null,-1)])])),[[M,a.value]]),l("span",null,d(k.slice(r(o).pos)),1)],64)):(c(),u("span",pe,d(k),1))])])]))),256))]),l("textarea",{ref:"textarea",style:U([{position:"fixed",width:"100%"},{top:r(t).textareaPos.top+"px",left:"4rem"}])},null,4)],64))}},_e=h(fe,[["__scopeId","data-v-cc1dae97"]]),he={class:"app"},me={__name:"edit",setup(i){const t=_(new F);K("instance",t);const n=()=>{Object.assign(t,new F)};return(e,s)=>(c(),u("div",he,[p(J,null,{default:f(()=>[p(Y,{label:r(v).data.edit.menubar.file.label},{default:f(()=>[p(y,{"key-bind":["Ctrl","N"],handler:n},{default:f(()=>[b(d(r(v).data.edit.menubar.file.start_with_new),1)]),_:1}),p($),p(y,{"key-bind":["Ctrl","S"],handler:()=>t.save_to_local()},{default:f(()=>[b(d(r(v).data.edit.menubar.file.save_to_local),1)]),_:1},8,["handler"]),p($),p(y,{"key-bind":["Ctrl","Q"],handler:()=>r(q).push("/")},{default:f(()=>[b(d(r(v).data.edit.menubar.file.quit),1)]),_:1},8,["handler"])]),_:1},8,["label"])]),_:1}),p(_e)]))}},be=h(me,[["__scopeId","data-v-667816b0"]]);export{be as default};
