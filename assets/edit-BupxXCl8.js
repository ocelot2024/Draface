import{_ as g,c as O,a as m,o as c,r as $,n as W,b as _,d as y,w as o,e as p,f as d,g as U,t as v,p as re,h as ue,i as Q,V as I,j as X,A as b,E as z,T as P,k as D,u as E,l as Y,m as de,q as N,v as Z,F as k,s as L,M as T,x as pe,y as ee,z as ce,B as R,C as fe,D as te,G as me,H as ne,I as F,J as _e,K as ve,L as ge}from"./index-BqyBRHfB.js";const we={__name:"Hstack",props:{Spacing:[Number,String],Align:String,Justify:String},setup(n){const e=n,t=O(()=>({display:"flex",flexDirection:"row",alignItems:e.Align||"center",justifyContent:e.Justify||"center",gap:e.Spacing+"px"||0}));return(a,s)=>(c(),m("div",{class:"h-stack",style:W(t.value)},[$(a.$slots,"default",{},void 0,!0)],4))}},x=g(we,[["__scopeId","data-v-458f31d9"]]),xe={},be={class:"material-symbols-rounded"};function ye(n,e){return c(),m("span",be,[$(n.$slots,"default",{},void 0,!0)])}const J=g(xe,[["render",ye],["__scopeId","data-v-cba4735d"]]),he={class:"menu-buttons"},ke={__name:"MenuBar",emits:["help"],setup(n){const e=_(!0),t=_(null);return re("menu_manager",{openID:t,open(a){t.value=t.value===a?null:a},close(){t.value=null}}),(a,s)=>(c(),y(x,{class:"menu-bar blurred","-justify":"left"},{default:o(()=>[p("div",he,[d(x,{"-justify":"left",style:{width:"100vw"}},{default:o(()=>[d(x,{"-justify":"left","-spacing":"14",style:{flex:"1"}},{default:o(()=>[$(a.$slots,"default",{},void 0,!0)]),_:3}),d(x,{style:{flex:"0","padding-right":"24px"},"-spacing":"14"},{default:o(()=>[d(J,{onClick:s[0]||(s[0]=i=>a.$emit("help"))},{default:o(()=>s[2]||(s[2]=[U("help")])),_:1,__:[2]}),d(J,{onClick:s[1]||(s[1]=i=>e.value=!e.value)},{default:o(()=>[U(v(e.value?"keep":"keep_off"),1)]),_:1})]),_:1})]),_:3})])]),_:3}))}},$e=g(ke,[["__scopeId","data-v-83c104e1"]]),Ee={class:"menu-wrapper"},je={__name:"MenuButton",props:["label"],setup(n){const e=n,t=_(ue()),a=Q("menu_manager"),s=O(()=>a.openID.value===t.value),i=()=>{a.open(t.value)};return(r,l)=>(c(),m("div",Ee,[p("button",{class:"menu-button",onClick:l[0]||(l[0]=u=>i())},v(e.label),1),p("div",{class:X(["menu-list blurred",{open:s.value}])},[d(I,{justify:"flex-start"},{default:o(()=>[$(r.$slots,"default",{},void 0,!0)]),_:3})],2)]))}},Ie=g(je,[["__scopeId","data-v-039af5d5"]]),Ce={__name:"MenuItem",props:{key_bind:Object,separate:{default(){return"none"},validator(n,e){return["above","bellow","none"].includes(n)}}},emits:["menu_click"],setup(n,{emit:e}){const t=n,a=e,s=Q("menu_manager"),i=()=>{s.close(),a("menu_click")};return(r,l)=>(c(),m("span",{class:X([t.separate,"menu-item"]),onClick:i},[$(r.$slots,"default",{},void 0,!0)],2))}},Se=g(Ce,[["__scopeId","data-v-5be2fc5c"]]),Me=(n,e,t,a)=>{if(!["Enter","Tab"].includes(n.key))return;const s=e.value;if(!s)return;const i=s.value,r=s.selectionStart,l=i.slice(0,r),u=i.slice(r),f=b.apps.Editor.indent_char==z.indent_char.Space?" ".repeat(P[b.apps.Editor.space_len]):"	";if(n.key==="Tab")n.preventDefault(),t.value=l+f+u,D(()=>s.selectionStart=s.selectionEnd=r+f.length);else if(n.key==="Enter"){n.preventDefault();const w=l.split(`
`),C=w[w.length-1];let S="";for(const h of C)if(h===" "||h==="	")S+=h;else break;let V=`
`;if(b.apps.Editor.indent_char===z.indent_char.Space){const h=S.split("").filter(ie=>ie===" ").length,B=Math.floor(h/P[b.apps.Editor.space_len]);V+=f.repeat(B)}else{const h=S.split("").filter(B=>B==="	").length;V+=f.repeat(h)}const A=w.join(`
`)+V;t.value=A+u,se(n,e,t,a),D(()=>s.selectionStart=s.selectionEnd=A.length)}};let q;const se=(n,e,t,a)=>{cancelAnimationFrame(q),q=requestAnimationFrame(()=>{a.value=e.value.value.split(`
`)})},G=(n,e,t)=>{n.value&&requestAnimationFrame(()=>{const a=n.value.selectionStart,s=e.value.slice(0,a),i=s.split(`
`).length-1,r=s.split(`
`).pop().length;t.value={line:i,column:r}})},Ue={class:"text-canvas"},De={class:"row_num"},Le={style:{flex:"1","white-space":"pre-wrap","word-break":"break-word"}},Ve={__name:"editor",props:{modelValue:{},modelModifiers:{}},emits:["update:modelValue"],setup(n){const e=_(null),t=E(n,"modelValue"),a=_([""]),s=_({line:0,column:0}),i=l=>{Me(l,e,t,a),D(()=>{G(e,t,s)})},r=l=>{se(l,e,t,a),D(()=>{G(e,t,s)})};return Y(()=>{e.value.focus(),e.value.addEventListener("keydown",i),e.value.addEventListener("click",oninput)}),de(()=>{e.value.removeEventListener("keydown",i),e.value.removeEventListener("click",oninput)}),(l,u)=>(c(),m(k,null,[N(p("textarea",{id:"editor",ref_key:"text_input",ref:e,"onUpdate:modelValue":u[0]||(u[0]=f=>t.value=f),onInput:r},null,544),[[Z,t.value]]),p("div",Ue,[(c(!0),m(k,null,L(a.value,(f,w)=>(c(),m("div",{style:{display:"flex","font-size":"large"},key:w},[p("div",De,v(w+1),1),p("div",Le,[w===s.value.line?(c(),m(k,{key:0},[p("span",null,v(f.slice(0,s.value.column)),1),u[1]||(u[1]=p("span",{class:"caret-parent"},[p("span",{class:"caret"})],-1)),p("span",null,v(f.slice(s.value.column)),1)],64)):(c(),m(k,{key:1},[U(v(f),1)],64))])]))),128))])],64))}},Be=g(Ve,[["__scopeId","data-v-dfc3224f"]]),Fe="/Neffice/edit.svg",Oe={__name:"about",props:{shown:{},shownModifiers:{}},emits:["update:shown"],setup(n){const e=E(n,"shown");return(t,a)=>(c(),y(T,{shown:e.value,"onUpdate:shown":a[0]||(a[0]=s=>e.value=s)},{default:o(()=>[d(I,{style:{padding:"7px"}},{default:o(()=>a[1]||(a[1]=[p("img",{src:Fe,width:"150px"},null,-1),p("h1",null,"Edit",-1),p("p",null,"ブラウザ上で動作するシンプルなテキストエディタ。",-1),p("br",null,null,-1),p("small",null,"Built with Vue.js",-1)])),_:1,__:[1]})]),_:1},8,["shown"]))}},Ne={style:{width:"100%"}},Te={key:0},Ae={__name:"groupBox",props:["header","bg"],setup(n){const e=n;return(t,a)=>(c(),m("div",Ne,[e.header?(c(),m("small",Te,v(e.header),1)):pe("",!0),p("div",{class:"group",style:W({backgroundColor:e.bg??"var(--colour-foreground)"})},[$(t.$slots,"default",{},void 0,!0)],4)]))}},ae=g(Ae,[["__scopeId","data-v-60daa9a3"]]),ze={__name:"ListItem",emits:["click"],setup(n){return(e,t)=>(c(),m("div",{class:"listitem",onClick:t[0]||(t[0]=a=>e.$emit("click"))},[$(e.$slots,"default",{},void 0,!0)]))}},M=g(ze,[["__scopeId","data-v-3fa901d1"]]),Pe={style:{padding:"7px"}},Re={__name:"PullDown",props:ee(["options"],{selected:{},selectedModifiers:{}}),emits:["update:selected"],setup(n){const e=n,t=E(n,"selected"),a=_(!1),s=O(()=>e.options[t.value]??"選択してください"),i=u=>{t.value=u,a.value=!1},r=_(null),l=u=>{r.value&&!r.value.contains(u.target)&&(a.value=!1)};return Y(()=>{document.addEventListener("click",l)}),ce(()=>{document.removeEventListener("click",l)}),(u,f)=>(c(),m("div",{class:"border",ref_key:"DropDown_ref",ref:r},[d(x,{spacing:10,onClick:[f[0]||(f[0]=w=>a.value=!0),f[1]||(f[1]=R(()=>{},["stop"]))]},{default:o(()=>[(c(),m("div",{style:{"min-width":"85px",width:"max-content"},key:t.value},v(s.value),1)),f[3]||(f[3]=p("div",{class:"triangle"},null,-1))]),_:1,__:[3]}),N(d(I,{class:"options blurred",align:"start",onClick:f[2]||(f[2]=R(()=>{},["stop"]))},{default:o(()=>[d(ae,{bg:"transparent"},{default:o(()=>[(c(!0),m(k,null,L(e.options,(w,C)=>(c(),y(M,{key:C,onClick:S=>i(C)},{default:o(()=>[p("div",Pe,v(w),1)]),_:2},1032,["onClick"]))),128))]),_:1})]),_:1},512),[[fe,a.value]])],512))}},H=g(Re,[["__scopeId","data-v-18dce54b"]]),Je={__name:"settings",props:{shown:{},shownModifiers:{}},emits:["update:shown"],setup(n){const e=E(n,"shown"),t=_(b.apps.Editor.indent_char),a=_(b.apps.Editor.space_len),s={footerButtons:[{label:"キャンセル",onClick:()=>{e.value=!1}},{label:"保存",type:"primary",onClick:()=>{b.apps.Editor.indent_char=t.value,b.apps.Editor.space_len=a.value,me(),e.value=!1}}]};return(i,r)=>(c(),y(T,te({shown:e.value,"onUpdate:shown":r[2]||(r[2]=l=>e.value=l)},s),{default:o(()=>[d(I,{class:"modal"},{default:o(()=>[d(ae,{header:"エディタ"},{default:o(()=>[d(M,null,{default:o(()=>[d(x,{"-justify":"flex-start",style:{padding:"7px"}},{default:o(()=>[r[3]||(r[3]=p("p",{style:{flex:"1"}},"タブの種類",-1)),d(H,{style:{flex:"0"},selected:t.value,"onUpdate:selected":r[0]||(r[0]=l=>t.value=l),options:["タブ文字","スペース"]},null,8,["selected"])]),_:1,__:[3]})]),_:1}),d(M,null,{default:o(()=>[d(x,{"-justify":"flex-start",style:{padding:"7px"}},{default:o(()=>[r[4]||(r[4]=p("p",{style:{flex:"1"}},"タブの文字数",-1)),d(H,{style:{flex:"0"},selected:a.value,"onUpdate:selected":r[1]||(r[1]=l=>a.value=l),options:[2,4,8]},null,8,["selected"])]),_:1,__:[4]})]),_:1}),d(M,null,{default:o(()=>[d(x,{"-justify":"flex-start",style:{padding:"7px"}},{default:o(()=>r[5]||(r[5]=[p("p",null,"改行時にインデントを保持する",-1)])),_:1,__:[5]})]),_:1})]),_:1})]),_:1})]),_:1},16,["shown"]))}},qe=g(Je,[["__scopeId","data-v-c71a2191"]]),Ge=(n,e)=>({label:n,items:e}),j=(n,e,t)=>({label:n,command:e,bind:{separate:t}}),He={txt:"text/plain",json:"application/json",js:"application/javascript",jsx:"text/jsx",ts:"application/typescript",tsx:"text/tsx",html:"text/html",css:"text/css",csv:"text/csv",xml:"application/xml",md:"text/markdown",pdf:"application/pdf",png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg",gif:"image/gif",bmp:"image/bmp",webp:"image/webp",svg:"image/svg+xml",mp3:"audio/mpeg",wav:"audio/wav",mp4:"video/mp4",mov:"video/quicktime",avi:"video/x-msvideo",zip:"application/zip",tar:"application/x-tar",gz:"application/gzip",rar:"application/vnd.rar",exe:"application/octet-stream",bin:"application/octet-stream"},Ke=n=>{if(!n)return"application/octet-stream";const e=n.toLowerCase();return He[e]??"application/octet-stream"},K=async n=>{const e=URL.createObjectURL(await n.to_blob()),t=document.createElement("a");t.download=n.get_filename(),t.href=e,t.click(),URL.revokeObjectURL(e)},We=async()=>{const[n]=await window.showOpenFilePicker(),e=await n.getFile();return await{data:await e.text(),filename:e.name}};class le{constructor(e){this.filename=_(e),this.created_at=new Date,this.data={},this.extension="nf",this.created_application="hq"}get_filename(){return this.filename+"."+this.extension}async to_blob(){const e=JSON.stringify({filename:this.filename,created_at:this.created_at,data:this.data});return new Blob([e],{type:this.get_mime()})}async from_blob(e){const t=new FileReader;return new Promise((a,s)=>{t.onload=()=>{try{const i=JSON.parse(t.result);this.data=i.data,this.filename=i.filename,this.created_at=new Date(i.created_at),a(i)}catch{s("failed parse a file.")}},t.onerror=()=>{s(t.error)},t.readAsText(e)})}get_mime(){return"application/octet-stream"}}const Qe=n=>{const e=n.lastIndexOf(".");return e!==-1?n.substring(0,e):n},Xe=n=>{const e=n.lastIndexOf(".");return e!==-1?n.substring(e+1):""},Ye=async n=>{const e=await We();try{const a=JSON.parse(e.data);if(ne.short in a){const s=new Ze(Qe(e.filename));return Object.assign(s.data,a),Object.assign(n,s),s}}catch{}const t=new oe(e.filename);return t.data.value=e.data,Object.assign(n,t),t};class Ze extends le{constructor(e){super(e),this.extension="nfe",this.created_application=ne.short,this.data=F({content:""})}}class oe extends le{constructor(e){super(e),this.extension=Xe(e),this.created_application="UNKNOWN",this.data=_("")}async to_blob(){return new Blob([this.data])}get_mime(){return Ke(this.extension)}}const et={__name:"saveas",props:{shown:{},shownModifiers:{},filename:{},filenameModifiers:{}},emits:ee(["save_as"],["update:shown","update:filename"]),setup(n){const e=E(n,"shown"),t=E(n,"filename");return(a,s)=>(c(),y(T,{shown:e.value,"onUpdate:shown":s[3]||(s[3]=i=>e.value=i),show_buttons:!1},{default:o(()=>[d(I,{justify:"start",spacing:14,style:{padding:"7px"}},{default:o(()=>s[4]||(s[4]=[p("h2",null,"名前をつけて保存",-1)])),_:1,__:[4]}),d(x,{style:{padding:"7px"},"-spacing":14},{default:o(()=>[p("button",{onClick:s[0]||(s[0]=i=>e.value=!1)},"キャンセル"),N(p("input",{type:"text","onUpdate:modelValue":s[1]||(s[1]=i=>t.value=i)},null,512),[[Z,t.value]]),p("button",{class:"primary",onClick:s[2]||(s[2]=i=>a.$emit("save_as"))},"保存")]),_:1})]),_:1},8,["shown"]))}},tt=g(et,[["__scopeId","data-v-df96dccc"]]),nt={style:{width:"4rem",overflow:"hidden","white-space":"nowrap","text-overflow":"ellipsis"}},at={__name:"edit",setup(n){const e=_(!1),t=_(!1),a=_(!1),s=F(new oe("untitle")),i=F([Ge("ファイル",[j("開く",()=>Ye(s)),j("保存",()=>K(s)),j("名前をつけて保存",()=>a.value=!0,"none"),j("環境設定",()=>t.value=!0,"above"),j("閉じる",()=>ge.back(),"above")])]);return(r,l)=>(c(),y(ve,null,{default:o(()=>[d($e,{onHelp:l[0]||(l[0]=u=>e.value=!0),style:{position:"fixed","z-index":"9999999"}},{default:o(()=>[p("strong",nt,v(s.filename),1),(c(!0),m(k,null,L(i,u=>(c(),y(Ie,{label:u.label,key:u},{default:o(()=>[(c(!0),m(k,null,L(u.items,f=>(c(),y(Se,te({ref_for:!0},f.bind,{onMenu_click:f.command,key:f}),{default:o(()=>[U(v(f.label),1)]),_:2},1040,["onMenu_click"]))),128))]),_:2},1032,["label"]))),128))]),_:1}),d(x,{style:{position:"fixed",inset:"0",top:"35px"},"-spacing":"0"},{default:o(()=>[d(Be,{modelValue:s.data,"onUpdate:modelValue":l[1]||(l[1]=u=>s.data=u)},null,8,["modelValue"])]),_:1}),d(Oe,{shown:e.value,"onUpdate:shown":l[2]||(l[2]=u=>e.value=u)},null,8,["shown"]),d(qe,{shown:t.value,"onUpdate:shown":l[3]||(l[3]=u=>t.value=u)},null,8,["shown"]),d(tt,{shown:a.value,"onUpdate:shown":l[4]||(l[4]=u=>a.value=u),filename:s.filename,"onUpdate:filename":l[5]||(l[5]=u=>s.filename=u),onSave_as:l[6]||(l[6]=()=>_e(K)(s))},null,8,["shown","filename"])]),_:1}))}};export{at as default};
